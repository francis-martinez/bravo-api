<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
  </head>
  <body>
    <h1>Bravo</h1>
    <button onclick="doLogin()">Login</button>
    <h3 id="ping-result"></h3>

    <script type="module">
      import init, { ping, login } from "./pkg/openapi.js";

      let wasmReady = false;

      async function bootstrap() {
        await init();
        wasmReady = true;
        console.log("WASM ready");
      }

      async function doPing() {
        try {
          const pingRes = await ping();
          const pingResult = document.getElementById("ping-result");

          pingResult.textContent = pingRes.ok ? "✅ API is up" : "❌ API error";
        } catch (err) {
          console.error(err);
        }
      }

      async function doLogin() {
        if (!wasmReady) {
          alert("WASM not ready yet");
          return;
        }

        const username = prompt("Username:");
        const password = prompt("Password:");

        if (!username || !password) {
          alert("Missing credentials");
          return;
        }

        try {
          const result = await login(username, password);
          doPing();
        } catch (err) {
          console.error(err);
          alert("Login failed");
        }
      }

      window.doLogin = doLogin;

      bootstrap();
    </script>
  </body>
</html>
